<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Data backup | Ryten lab induction book</title>
  <meta name="description" content="Induction bookdown for all things Ryten lab" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Data backup | Ryten lab induction book" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Induction bookdown for all things Ryten lab" />
  <meta name="github-repo" content="rytenlab/ryten_induction" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Data backup | Ryten lab induction book" />
  
  <meta name="twitter:description" content="Induction bookdown for all things Ryten lab" />
  

<meta name="author" content="" />


<meta name="date" content="2020-11-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="server-usage.html"/>
<link rel="next" href="resources.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome!</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#useful-links"><i class="fa fa-check"></i><b>1.1</b> Useful links</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.2</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="contribute.html"><a href="contribute.html"><i class="fa fa-check"></i><b>2</b> Contributing guide</a><ul>
<li class="chapter" data-level="2.1" data-path="contribute.html"><a href="contribute.html#why-contribute"><i class="fa fa-check"></i><b>2.1</b> Why contribute?</a></li>
<li class="chapter" data-level="2.2" data-path="contribute.html"><a href="contribute.html#what-should-i-contribute"><i class="fa fa-check"></i><b>2.2</b> What should I contribute?</a></li>
<li class="chapter" data-level="2.3" data-path="contribute.html"><a href="contribute.html#contribute-how"><i class="fa fa-check"></i><b>2.3</b> How should I contribute?</a><ul>
<li class="chapter" data-level="2.3.1" data-path="contribute.html"><a href="contribute.html#basics"><i class="fa fa-check"></i><b>2.3.1</b> Basics</a></li>
<li class="chapter" data-level="2.3.2" data-path="contribute.html"><a href="contribute.html#adding-references"><i class="fa fa-check"></i><b>2.3.2</b> Adding References</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="learning-r.html"><a href="learning-r.html"><i class="fa fa-check"></i><b>3</b> Learning R</a><ul>
<li class="chapter" data-level="3.1" data-path="learning-r.html"><a href="learning-r.html#why-r"><i class="fa fa-check"></i><b>3.1</b> Why R?</a></li>
<li class="chapter" data-level="3.2" data-path="learning-r.html"><a href="learning-r.html#r-resources"><i class="fa fa-check"></i><b>3.2</b> R resources</a><ul>
<li class="chapter" data-level="3.2.1" data-path="learning-r.html"><a href="learning-r.html#beginner-r"><i class="fa fa-check"></i><b>3.2.1</b> Beginner</a></li>
<li class="chapter" data-level="3.2.2" data-path="learning-r.html"><a href="learning-r.html#intermediate"><i class="fa fa-check"></i><b>3.2.2</b> Intermediate</a></li>
<li class="chapter" data-level="3.2.3" data-path="learning-r.html"><a href="learning-r.html#advanced"><i class="fa fa-check"></i><b>3.2.3</b> Advanced</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="learning-r.html"><a href="learning-r.html#asking-for-help"><i class="fa fa-check"></i><b>3.3</b> Asking for help</a><ul>
<li class="chapter" data-level="3.3.1" data-path="learning-r.html"><a href="learning-r.html#where-to-ask-for-help"><i class="fa fa-check"></i><b>3.3.1</b> Where to ask for help?</a></li>
<li class="chapter" data-level="3.3.2" data-path="learning-r.html"><a href="learning-r.html#how-to-ask-for-help"><i class="fa fa-check"></i><b>3.3.2</b> How to ask for help?</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="learning-r.html"><a href="learning-r.html#teaching-r"><i class="fa fa-check"></i><b>3.4</b> Teaching R</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="server-usage.html"><a href="server-usage.html"><i class="fa fa-check"></i><b>4</b> Server usage</a><ul>
<li class="chapter" data-level="4.1" data-path="server-usage.html"><a href="server-usage.html#why-use-the-ryten-server"><i class="fa fa-check"></i><b>4.1</b> Why use the Ryten server?</a></li>
<li class="chapter" data-level="4.2" data-path="server-usage.html"><a href="server-usage.html#usage-guide"><i class="fa fa-check"></i><b>4.2</b> Usage guide</a></li>
<li class="chapter" data-level="4.3" data-path="server-usage.html"><a href="server-usage.html#how-to-connect-to-a-remote-server"><i class="fa fa-check"></i><b>4.3</b> How to connect to a remote server?</a><ul>
<li class="chapter" data-level="4.3.1" data-path="server-usage.html"><a href="server-usage.html#setup-ucl-vpn"><i class="fa fa-check"></i><b>4.3.1</b> Setup UCL VPN</a></li>
<li class="chapter" data-level="4.3.2" data-path="server-usage.html"><a href="server-usage.html#are-you-a-windows-user"><i class="fa fa-check"></i><b>4.3.2</b> Are you a Windows user?</a></li>
<li class="chapter" data-level="4.3.3" data-path="server-usage.html"><a href="server-usage.html#connect-rserver"><i class="fa fa-check"></i><b>4.3.3</b> Connecting via RStudio Server</a></li>
<li class="chapter" data-level="4.3.4" data-path="server-usage.html"><a href="server-usage.html#connecting-via-a-shell-session"><i class="fa fa-check"></i><b>4.3.4</b> Connecting via a shell session</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-backup.html"><a href="data-backup.html"><i class="fa fa-check"></i><b>5</b> Data backup</a><ul>
<li class="chapter" data-level="5.1" data-path="data-backup.html"><a href="data-backup.html#why-backup-your-data-stored-on-the-ryten-server"><i class="fa fa-check"></i><b>5.1</b> Why backup your data stored on the Ryten server?</a></li>
<li class="chapter" data-level="5.2" data-path="data-backup.html"><a href="data-backup.html#what-options-are-available-to-you-as-ryten-server-user"><i class="fa fa-check"></i><b>5.2</b> What options are available to you as Ryten server user?</a></li>
<li class="chapter" data-level="5.3" data-path="data-backup.html"><a href="data-backup.html#what-are-good-practices-for-data-backup"><i class="fa fa-check"></i><b>5.3</b> What are good practices for data backup?</a></li>
<li class="chapter" data-level="5.4" data-path="data-backup.html"><a href="data-backup.html#aws"><i class="fa fa-check"></i><b>5.4</b> AWS</a></li>
<li class="chapter" data-level="5.5" data-path="data-backup.html"><a href="data-backup.html#github"><i class="fa fa-check"></i><b>5.5</b> Github</a></li>
<li class="chapter" data-level="5.6" data-path="data-backup.html"><a href="data-backup.html#ucl-rds"><i class="fa fa-check"></i><b>5.6</b> UCL RDS</a><ul>
<li class="chapter" data-level="5.6.1" data-path="data-backup.html"><a href="data-backup.html#registering-a-project"><i class="fa fa-check"></i><b>5.6.1</b> Registering a project</a></li>
<li class="chapter" data-level="5.6.2" data-path="data-backup.html"><a href="data-backup.html#accessing-your-project-space"><i class="fa fa-check"></i><b>5.6.2</b> Accessing your project space</a></li>
<li class="chapter" data-level="5.6.3" data-path="data-backup.html"><a href="data-backup.html#using-rsync-to-backup-to-ucl-rds"><i class="fa fa-check"></i><b>5.6.3</b> Using <code>rsync</code> to backup to UCL RDS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>6</b> Resources</a><ul>
<li class="chapter" data-level="6.1" data-path="resources.html"><a href="resources.html#how-tos"><i class="fa fa-check"></i><b>6.1</b> How-tos</a></li>
<li class="chapter" data-level="6.2" data-path="resources.html"><a href="resources.html#reproducible-science"><i class="fa fa-check"></i><b>6.2</b> Reproducible science</a></li>
<li class="chapter" data-level="6.3" data-path="resources.html"><a href="resources.html#books"><i class="fa fa-check"></i><b>6.3</b> Books</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>7</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ryten lab induction book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data_backup" class="section level1">
<h1><span class="header-section-number">5</span> Data backup</h1>
<p>The purpose of this chapter is to guide you through the available options for backup of data stored on the Ryten server. For backup of data on your personal/work computers, we recommend making use of cloud solutions, such as OneDrive for Business, available to <a href="https://www.ucl.ac.uk/isd/services/communicate-collaborate/remote-working/file-storage">UCL staff and students</a>.</p>
<blockquote>
<p>Note: <strong>data backup is the responsibility of each Ryten server user</strong>. We do not currently have any automated systems in place, so it is really important that you take the time to ensure you have all the proper backups in place.</p>
</blockquote>
<div id="why-backup-your-data-stored-on-the-ryten-server" class="section level2">
<h2><span class="header-section-number">5.1</span> Why backup your data stored on the Ryten server?</h2>
<p>There are several good reasons to backup your data stored on the Ryten server, including:</p>
<ul>
<li>As with all other servers, the Ryten server can also be affected by server failure (this has not happened to us, *touch wood*, but it certainly can).</li>
<li>There may be occasions when you cannot access the server (e.g. VPN does not permit access).</li>
<li>Other users may accidentally delete or modify one of your files (yes, this has happened in the past).</li>
</ul>
<p>In short, a lot of things can happen, which might mean you need to access your files via other means. Thus, it is important to have a backup of the raw files you use, any processed intermediate files, and the scripts you use both for data processing and analysis.</p>
</div>
<div id="what-options-are-available-to-you-as-ryten-server-user" class="section level2">
<h2><span class="header-section-number">5.2</span> What options are available to you as Ryten server user?</h2>
<p>Luckily, there are plenty of options available to you, including:</p>
<ul>
<li><p><strong>Amazon Web Services (AWS)</strong></p>
<ul>
<li>The Ryten lab has an account on AWS where it is possible to store data.</li>
<li>We primarily use this for unprocessed data (e.g. RNA-sequencing FASTQs), although it can also be useful to store processed files (e.g. BAMs) that collaborators may ask to access.</li>
</ul></li>
<li><p><a href="https://github.com/"><strong>GitHub</strong></a></p>
<ul>
<li>Git is a version control system (think “Track Changes” in Word), while GitHub is a cloud-based hosting service for Git-based projects (think OneDrive).</li>
<li>We primarily use this to store functions, scripts and workflows for our analyses.</li>
<li>Importantly, as a student/researcher you can access a free/discounted version of GitHub Pro, which allows users to have private repositories. Private repositories are useful for ongoing projects that are not ready for publication just yet. Upon publication, these private repositories can be made public.</li>
<li>If you’re unfamiliar with GitHub or <code>git</code>, please refer to this handy <a href="https://happygitwithr.com/">guide</a>, also mentioned in Section <a href="contribute.html#contribute-how">2.3</a>.</li>
</ul></li>
<li><p><a href="https://www.ucl.ac.uk/isd/services/research-it/research-data-storage-service"><strong>UCL RDS</strong></a></p>
<ul>
<li>This is a UCL-based service, while allows UCL staff to store research data while projects are ongoing.</li>
<li>We primarily use this to store processed intermediate files.</li>
</ul></li>
</ul>
</div>
<div id="what-are-good-practices-for-data-backup" class="section level2">
<h2><span class="header-section-number">5.3</span> What are good practices for data backup?</h2>
<ul>
<li>It is a good idea to ensure that <strong>really important</strong> files that cannot be regenerated (e.g. raw sequencing files) or alternatively would take days/weeks to re-generate are stored in <strong>two</strong> backup locations.</li>
<li>Make sure the scripts you need to re-generate analyses/files are on GitHub.</li>
<li>Ensure that you have an easily accessible record of what you are backing up and where.</li>
<li>Most importantly, make sure you regularly backup to these locations. E.g. ongoing projects should be backed up to UCL RDS at least once a month, while scripts/workflows should preferably be committed to GitHub daily/weekly.</li>
</ul>
</div>
<div id="aws" class="section level2">
<h2><span class="header-section-number">5.4</span> AWS</h2>
<p><strong>Sonia Garcia Ruiz</strong> is our AWS guru. You will need to get in contact with Sonia to arrange access to our AWS account. Thereafter, here are some useful links, also generated by Sonia. These links are hosted on the Ryten lab <a href="https://liveuclac.sharepoint.com/sites/rytenlab/Shared%20Documents/">Sharepoint</a>, which you can access provided you are a member.</p>
<ul>
<li><a href="https://liveuclac.sharepoint.com/:w:/r/sites/rytenlab/Shared%20Documents/Amazon/AWS_CONFIGURATION.docx?d=w6195a43440b04e8cbff82e369e73befa&amp;csf=1&amp;web=1&amp;e=G0jGbp">Accessing AWS using the AWS Command Line Interface</a></li>
<li><a href="https://liveuclac.sharepoint.com/:w:/r/sites/rytenlab/Shared%20Documents/Amazon/AWS_ETag_MD5.docx?d=we739c02ec69947b6b4044e60204cc90b&amp;csf=1&amp;web=1&amp;e=fTLLE7">Checking AWS file integrity</a></li>
<li><a href="https://liveuclac.sharepoint.com/:w:/r/sites/rytenlab/Shared%20Documents/Amazon/Buckets%20info.docx?d=w3f931f44bea54aef98c08eb359fef169&amp;csf=1&amp;web=1&amp;e=CzTYog">Information about existing AWS buckets</a></li>
</ul>
</div>
<div id="github" class="section level2">
<h2><span class="header-section-number">5.5</span> Github</h2>
<p>A good explanation of how to get started with <code>git</code> using RStudio can be in the book “Happy Git with R” linked <a href="learning-r.html#beginner-r">here</a>.</p>
<p>TO BE ADDED (MAYBE A SEPARATE PAGE WITH GITHUB TUTORIAL?). Link worth adding: <a href="https://www.makeareadme.com/" class="uri">https://www.makeareadme.com/</a></p>
</div>
<div id="ucl-rds" class="section level2">
<h2><span class="header-section-number">5.6</span> UCL RDS</h2>
<div id="registering-a-project" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Registering a project</h3>
<ul>
<li>Prior to using UCL RDS, you need to ensure that you have a project space allocated to you. This can be done <a href="https://www.ucl.ac.uk/isd/services/research-it/research-data-storage-service">here</a>.</li>
<li>If you are not UCL staff, you will not be able to register your own project. If that is the case, reach out to one of us that is, and we can register a project on your behalf and add you as a project member.</li>
</ul>
</div>
<div id="accessing-your-project-space" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Accessing your project space</h3>
<ul>
<li>When the project was generated, <a href="mailto:researchdata-support@ucl.ac.uk" class="email">researchdata-support@ucl.ac.uk</a> will send you an e-mail with important details about the location of your storage area (an example is: <code>/mnt/gpfs/live/rd01__/ritd-ag-project-rd010p-sgarc61/</code>)</li>
<li>From the Ryten server, this project space can be accessed using the following command, and substituting your UCL username into the command below, instead of <code>ucl_username</code>.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="data-backup.html#cb7-1"></a><span class="fu">ssh</span> ucl_username@live.rd.ucl.ac.uk </span></code></pre></div>
<ul>
<li>You will be prompted for a password, and upon entering this you will be re-directed to your home space on UCL RDS. You can then move to your project area using the following command, and substituting in the path to your storage area.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="data-backup.html#cb8-1"></a><span class="bu">cd</span> /mnt/gpfs/live/path_to_storage_area/</span></code></pre></div>
</div>
<div id="using-rsync-to-backup-to-ucl-rds" class="section level3">
<h3><span class="header-section-number">5.6.3</span> Using <code>rsync</code> to backup to UCL RDS</h3>
<ul>
<li><code>rsync</code> (remote sync), as the name suggests, permits file transfer across systems (e.g. from the Ryten server to UCL RDS).</li>
<li>While the initial backup will take a while, <code>rsync</code> is a super handy tool for regular backups, as it will only transfer files that have been changed after the initial backup.</li>
<li>Furthermore, with the correct flags enabled, you can ensure that any files that have been deleted on the local server (Ryten server) are not deleted on the remote server (UCL RDS) when running <code>rsync</code> again.</li>
</ul>
<div id="simple-use-case" class="section level4">
<h4><span class="header-section-number">5.6.3.1</span> Simple use case</h4>
<p>Google is a great resource, so feel free to read up a bit more on <code>rsync</code>. Also, you can always run the command <code>rsync --help</code> to see what options there are.</p>
<p>Below is a simple use case, with the various flags explained with the #.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="data-backup.html#cb9-1"></a><span class="co"># -a preserve access times etc</span></span>
<span id="cb9-2"><a href="data-backup.html#cb9-2"></a><span class="co"># -r recursive </span></span>
<span id="cb9-3"><a href="data-backup.html#cb9-3"></a><span class="co"># -v verbose</span></span>
<span id="cb9-4"><a href="data-backup.html#cb9-4"></a><span class="co"># -h human readable figures</span></span>
<span id="cb9-5"><a href="data-backup.html#cb9-5"></a><span class="co"># -e select the protocol - ssh used here </span></span>
<span id="cb9-6"><a href="data-backup.html#cb9-6"></a><span class="co"># --progress display progress bar</span></span>
<span id="cb9-7"><a href="data-backup.html#cb9-7"></a><span class="co"># --relative preserves directory structure in the local backup location from /./ onwards</span></span>
<span id="cb9-8"><a href="data-backup.html#cb9-8"></a></span>
<span id="cb9-9"><a href="data-backup.html#cb9-9"></a><span class="co"># Example</span></span>
<span id="cb9-10"><a href="data-backup.html#cb9-10"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative /path_to_files/ ucl_username@live.rd.ucl.ac.uk:/mnt/gpfs/live/path_to_storage_area/</span></code></pre></div>
<ul>
<li>Notice that the “source” location (<code>/path_to_files/</code>) is written first followed by the “target” location (<code>ucl_username@live.rd.ucl.ac.uk:/mnt/gpfs/live/path_to_storage_area/</code>).</li>
</ul>
</div>
<div id="backing-up-multiple-files-across-multiple-ucl-rds-spaces" class="section level4">
<h4><span class="header-section-number">5.6.3.2</span> Backing up multiple files across multiple UCL RDS spaces</h4>
<p>We all have multiple ongoing projects, which cannot all be stored in the same UCL RDS project space (which are typically restricted to 5 Tb). Thus, there will come a time when you have to backup to multiple locations. With this in mind, it can be helpful to write a script to automate (or at least partially automate) some of this. Below is a bare-bones guide of how you might do this.</p>
<p>As you have probably noticed if you have been using <code>rsync</code> to transfer files from the Ryten server to UCL RDS, every time you use this command you are prompted for a password. Thus, partial automation requires that you:</p>
<ol style="list-style-type: decimal">
<li>Set up an SSH key pair, which allows automated user authentication.</li>
<li>Write a script, which you can add to everytime you have another location to backup from/to.</li>
</ol>
<div id="ssh-agent" class="section level5">
<h5><span class="header-section-number">5.6.3.2.1</span> Step 1: Set up SSH keys for authentication</h5>
<p>I used this <a href="https://upcloud.com/community/tutorials/use-ssh-keys-authentication/">guide</a> to help me set this up.</p>
<p><strong>Preparing the remote server (e.g. UCL RDS)</strong></p>
<blockquote>
<p>Do this in your home directory on UCL RDS e.g. <code>/mnt/gpfs/home/skgtrhr/</code></p>
</blockquote>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="data-backup.html#cb10-1"></a><span class="co"># Create hidden folder in home directory</span></span>
<span id="cb10-2"><a href="data-backup.html#cb10-2"></a><span class="fu">mkdir</span> -p ~/.ssh</span>
<span id="cb10-3"><a href="data-backup.html#cb10-3"></a></span>
<span id="cb10-4"><a href="data-backup.html#cb10-4"></a><span class="co"># Restrict permissions</span></span>
<span id="cb10-5"><a href="data-backup.html#cb10-5"></a><span class="fu">chmod</span> 700 ~/.ssh</span></code></pre></div>
<p><strong>Generating the key pair</strong></p>
<blockquote>
<p>This is done in user’s home directory on the Ryten server where files will be transferred from e.g. <code>/home/rreynolds/</code>.</p>
</blockquote>
<ol style="list-style-type: decimal">
<li>To generate the key pair, enter the command below. Don’t enter a passphrase when prompted, if you would like to setup fully password-less login.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="data-backup.html#cb11-1"></a><span class="co"># Command to generate key pair</span></span>
<span id="cb11-2"><a href="data-backup.html#cb11-2"></a><span class="fu">ssh-keygen</span> -t rsa</span>
<span id="cb11-3"><a href="data-backup.html#cb11-3"></a></span>
<span id="cb11-4"><a href="data-backup.html#cb11-4"></a><span class="co"># Output will look like this</span></span>
<span id="cb11-5"><a href="data-backup.html#cb11-5"></a><span class="ex">Generating</span> public/private rsa key pair.</span>
<span id="cb11-6"><a href="data-backup.html#cb11-6"></a><span class="ex">Enter</span> file in which to save the key (/home/rreynolds/.ssh/id_rsa)<span class="bu">:</span> /home/rreynolds/.ssh/rds_rsa <span class="co"># press enter, or name accordingly as was done here</span></span>
<span id="cb11-7"><a href="data-backup.html#cb11-7"></a><span class="ex">Created</span> directory <span class="st">&#39;/home/rreynolds/.ssh&#39;</span>.</span>
<span id="cb11-8"><a href="data-backup.html#cb11-8"></a><span class="ex">Enter</span> passphrase (empty for no passphrase)<span class="bu">:</span> <span class="co"># press enter</span></span>
<span id="cb11-9"><a href="data-backup.html#cb11-9"></a><span class="ex">Enter</span> same passphrase again: <span class="co"># press enter</span></span>
<span id="cb11-10"><a href="data-backup.html#cb11-10"></a><span class="ex">Your</span> identification has been saved in /home/rreynolds/.ssh/rds_rsa.</span>
<span id="cb11-11"><a href="data-backup.html#cb11-11"></a><span class="ex">Your</span> public key has been saved in /home/rreynolds/.ssh/rds_rsa.pub.</span>
<span id="cb11-12"><a href="data-backup.html#cb11-12"></a><span class="ex">The</span> key fingerprint is:</span>
<span id="cb11-13"><a href="data-backup.html#cb11-13"></a><span class="ex">SHA256</span>:EXAMPLE rreynolds@ion-dmn-hpc3</span>
<span id="cb11-14"><a href="data-backup.html#cb11-14"></a><span class="ex">The</span> key<span class="st">&#39;s randomart image is:</span></span>
<span id="cb11-15"><a href="data-backup.html#cb11-15"></a><span class="st">+---[RSA 2048]----+</span></span>
<span id="cb11-16"><a href="data-backup.html#cb11-16"></a><span class="st">|            ..   |</span></span>
<span id="cb11-17"><a href="data-backup.html#cb11-17"></a><span class="st">|          EXAMPLE|</span></span>
<span id="cb11-18"><a href="data-backup.html#cb11-18"></a><span class="st">|          EXAMPLE|</span></span>
<span id="cb11-19"><a href="data-backup.html#cb11-19"></a><span class="st">|     EXAMPLE     |</span></span>
<span id="cb11-20"><a href="data-backup.html#cb11-20"></a><span class="st">|    EXAMPLE      |</span></span>
<span id="cb11-21"><a href="data-backup.html#cb11-21"></a><span class="st">|   EXAMPLE       |</span></span>
<span id="cb11-22"><a href="data-backup.html#cb11-22"></a><span class="st">|    EXAMPLE      |</span></span>
<span id="cb11-23"><a href="data-backup.html#cb11-23"></a><span class="st">|    EXAMPLE      |</span></span>
<span id="cb11-24"><a href="data-backup.html#cb11-24"></a><span class="st">|      EXAMPLE    |</span></span>
<span id="cb11-25"><a href="data-backup.html#cb11-25"></a><span class="st">+----[SHA256]-----+</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>If no different file name entered, the command will generate two files: <code>~/.ssh/id_rsa</code> (private key) and <code>~/.ssh/id_rsa.pub</code> (public key).</li>
<li>Copy the public half of the key pair to your cloud server using the following command. Replace the user and server with your username and the server address you wish to use the key authentication on. <strong>This assumes you saved the key pair using the default file name and location. If not, just replace the key path <code>~/.ssh/id_rsa.pub</code> your own key name (as I did below)</strong>.</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="data-backup.html#cb12-1"></a><span class="co"># Command</span></span>
<span id="cb12-2"><a href="data-backup.html#cb12-2"></a><span class="ex">ssh-copy-id</span> -i ~/.ssh/rds_rsa.pub skgtrhr@live.rd.ucl.ac.uk</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Set up SSH Agent to store the keys to avoid having to re-enter passphrase at every login. <strong>If you close the Ryten server terminal, you will have to repeat the command below when you open up a new terminal.</strong></li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="data-backup.html#cb13-1"></a><span class="fu">ssh-agent</span> <span class="va">$BASH</span></span>
<span id="cb13-2"><a href="data-backup.html#cb13-2"></a><span class="fu">ssh-add</span> ~/.ssh/rds_rsa</span></code></pre></div>
</div>
<div id="step-2-write-a-script-for-your-data-backup" class="section level5">
<h5><span class="header-section-number">5.6.3.2.2</span> Step 2: Write a script for <em>your</em> data backup</h5>
<blockquote>
<p>The author of this script, Regina, is hoping to make this a more generalised script at some point, but for now, feel free to copy and modify the skeleton below.</p>
</blockquote>
<p>Key arguments to modify include:</p>
<ul>
<li><code>rserver</code>: change to your UCL username.</li>
<li><code>lbackuploc_*</code>: change to your local backup locations. <em>Note: because I am using the <code>--relative</code> flag with <code>rsync</code>, I add a <code>/./</code> to indicate from what point I want <code>rsync</code> to copy the directory structure on the Ryten server.</em></li>
<li><code>rbackuploc_*</code>: change to your remote backup locations.</li>
<li>Main body of backup text to suit your purposes.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="data-backup.html#cb14-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb14-2"><a href="data-backup.html#cb14-2"></a></span>
<span id="cb14-3"><a href="data-backup.html#cb14-3"></a><span class="co"># Remote RDS server</span></span>
<span id="cb14-4"><a href="data-backup.html#cb14-4"></a><span class="va">rserver=</span>skgtrhr<span class="ex">@live.rd.ucl.ac.uk</span></span>
<span id="cb14-5"><a href="data-backup.html#cb14-5"></a></span>
<span id="cb14-6"><a href="data-backup.html#cb14-6"></a><span class="co"># Local backup location</span></span>
<span id="cb14-7"><a href="data-backup.html#cb14-7"></a><span class="va">lbackuploc_data=</span>/data/</span>
<span id="cb14-8"><a href="data-backup.html#cb14-8"></a><span class="va">lbackuploc_user=</span>/home/./rreynolds/</span>
<span id="cb14-9"><a href="data-backup.html#cb14-9"></a></span>
<span id="cb14-10"><a href="data-backup.html#cb14-10"></a><span class="co"># Remote RDS backup locations</span></span>
<span id="cb14-11"><a href="data-backup.html#cb14-11"></a><span class="va">rbackuploc_GWAS=</span>/mnt/gpfs/live/rd01__/ritd-ag-project-rd010p-sgarc61/</span>
<span id="cb14-12"><a href="data-backup.html#cb14-12"></a><span class="va">rbackuploc_PDseq=</span>/mnt/gpfs/live/ritd-ag-project-rd00v5-sgarc61/</span>
<span id="cb14-13"><a href="data-backup.html#cb14-13"></a></span>
<span id="cb14-14"><a href="data-backup.html#cb14-14"></a><span class="co">#---Backups to $rbackuploc_GWAS---------------</span></span>
<span id="cb14-15"><a href="data-backup.html#cb14-15"></a></span>
<span id="cb14-16"><a href="data-backup.html#cb14-16"></a><span class="bu">echo</span> <span class="st">&quot;Starting backup to </span><span class="va">$rserver</span><span class="st">:</span><span class="va">$rbackuploc_GWAS</span><span class="st">&quot;</span> </span>
<span id="cb14-17"><a href="data-backup.html#cb14-17"></a></span>
<span id="cb14-18"><a href="data-backup.html#cb14-18"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_user</span>/projects/LDSC_Regression/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_GWAS</span></span>
<span id="cb14-19"><a href="data-backup.html#cb14-19"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_user</span>/data/MAGMA/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_GWAS</span></span>
<span id="cb14-20"><a href="data-backup.html#cb14-20"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_user</span>/misc_projects <span class="va">$rserver</span>:<span class="va">$rbackuploc_GWAS</span></span>
<span id="cb14-21"><a href="data-backup.html#cb14-21"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_data</span>/LDScore/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_GWAS</span></span>
<span id="cb14-22"><a href="data-backup.html#cb14-22"></a></span>
<span id="cb14-23"><a href="data-backup.html#cb14-23"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_data</span>/Alasoo2018_MacrophageQTLs/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_GWAS</span></span>
<span id="cb14-24"><a href="data-backup.html#cb14-24"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_data</span>/Fairfax2014/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_GWAS</span></span>
<span id="cb14-25"><a href="data-backup.html#cb14-25"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_data</span>/eQTLGen/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_GWAS</span></span>
<span id="cb14-26"><a href="data-backup.html#cb14-26"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_data</span>/GTEx_eQTLs/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_GWAS</span></span>
<span id="cb14-27"><a href="data-backup.html#cb14-27"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_data</span>/psychencode/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_GWAS</span></span>
<span id="cb14-28"><a href="data-backup.html#cb14-28"></a></span>
<span id="cb14-29"><a href="data-backup.html#cb14-29"></a><span class="co">#---Backups to $rbackuploc_PDseq--------------</span></span>
<span id="cb14-30"><a href="data-backup.html#cb14-30"></a></span>
<span id="cb14-31"><a href="data-backup.html#cb14-31"></a><span class="bu">echo</span> <span class="st">&quot;Starting backup to </span><span class="va">$rserver</span><span class="st">:</span><span class="va">$rbackuploc_PDseq</span><span class="st">&quot;</span> </span>
<span id="cb14-32"><a href="data-backup.html#cb14-32"></a></span>
<span id="cb14-33"><a href="data-backup.html#cb14-33"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_data</span>/RNAseq_PD/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_PDseq</span></span>
<span id="cb14-34"><a href="data-backup.html#cb14-34"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_user</span>/projects/Aim2_PDsequencing_wd/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_PDseq</span></span>
<span id="cb14-35"><a href="data-backup.html#cb14-35"></a><span class="fu">rsync</span> -arvhe ssh --progress --relative <span class="va">$lbackuploc_data</span>/recount/SRP058181/ <span class="va">$rserver</span>:<span class="va">$rbackuploc_PDseq</span></span>
<span id="cb14-36"><a href="data-backup.html#cb14-36"></a></span>
<span id="cb14-37"><a href="data-backup.html#cb14-37"></a><span class="bu">echo</span> <span class="st">&quot;Backup finished!&quot;</span></span></code></pre></div>
</div>
<div id="step-3-running-your-script" class="section level5">
<h5><span class="header-section-number">5.6.3.2.3</span> Step 3: Running your script</h5>
<p>After creating script, remember to set an executable permission to the script. Substitute <code>RDS_backup.sh</code> for the name of your script.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="data-backup.html#cb15-1"></a><span class="co"># Command</span></span>
<span id="cb15-2"><a href="data-backup.html#cb15-2"></a><span class="fu">chmod</span> +x RDS_backup.sh</span></code></pre></div>
<p>The script can then be run with the follow command. It is a good idea to keep a log of your backups to see if any errors have been returned during the process. For this reason, the output of the backup script is re-directed into a new log file named <code>20201102_RDSbackup.log</code>, with the date of transfer.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="data-backup.html#cb16-1"></a><span class="co"># Run script and save log file</span></span>
<span id="cb16-2"><a href="data-backup.html#cb16-2"></a><span class="fu">bash</span> ./path_to_script/RDS_backup.sh <span class="op">&gt;</span> ./path_to_log_directory/20201102_RDSbackup.log</span></code></pre></div>
<p>Finally, remember that prior to running your backup script you will have to set up SSH Agent to store the keys (as mentioned in Section <a href="data-backup.html#ssh-agent">5.6.3.2.1</a>, step 4), if you have not already done so.</p>

</div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="server-usage.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="resources.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
